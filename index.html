<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP HAIANH - PHI√äN B·∫¢N SI√äU C·∫§P</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --green: #2ecc71; --red: #e74c3c; --dark: #2c3e50; --bg: #f1f2f6; --blue: #3498db; --orange: #f39c12; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 30px; }
        .header { background: var(--dark); color: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--green); position: sticky; top: 0; z-index: 1000; }
        .nav { display: flex; background: #fff; border-bottom: 1px solid #ddd; overflow-x: auto; }
        .tab { flex: 1; min-width: 80px; padding: 12px; text-align: center; font-size: 11px; font-weight: bold; color: #777; cursor: pointer; white-space: nowrap; }
        .tab.active { color: var(--green); border-bottom: 3px solid var(--green); }
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; max-width: 600px; margin: auto; }
        .game-card { background: #fff; border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s; }
        .game-card:active { transform: scale(0.95); }
        .acc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .acc-box { background: #fff; border-radius: 10px; padding: 10px; border: 1px solid #ddd; text-align: center; }
        .card { background: white; padding: 15px; border-radius: 10px; margin: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; }
        input:focus { border-color: var(--green); }
        button { border: none; border-radius: 8px; padding: 12px; font-weight: bold; cursor: pointer; color: white; width: 100%; transition: 0.3s; }
        .btn-buy { background: var(--green); } .btn-red { background: var(--red); } .btn-blue { background: var(--blue); } .btn-orange { background: var(--orange); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center; }
        .user-table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; }
        .user-table th, .user-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .btn-mini { padding: 4px 6px; font-size: 9px; width: auto; margin: 2px; display: inline-block; }
        .badge { background: #eee; padding: 2px 5px; border-radius: 4px; font-size: 9px; color: #555; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold; font-size: 18px;">SHOP HAIANH</div>
    <div id="auth-zone">K·∫øt n·ªëi...</div>
</div>

<div class="nav">
    <div class="tab active" onclick="goTab('buy', this)">MUA ACC</div>
    <div class="tab" onclick="goTab('topup', this)">N·∫†P TI·ªÄN</div>
    <div id="tab-his-btn" class="tab" style="display:none" onclick="goTab('his', this)">L·ªäCH S·ª¨</div>
    <div id="tab-adm-btn" class="tab" style="display:none" onclick="goTab('adm', this)">QU·∫¢N TR·ªä</div>
</div>

<div id="tab-buy" class="tab-sec">
    <div id="menu-game" class="grid-menu">
        <div class="game-card" onclick="openGame('Roblox')">ü§ñ<h3>Roblox</h3></div>
        <div class="game-card" onclick="openGame('Free Fire')">üî•<h3>Free Fire</h3></div>
        <div class="game-card" onclick="openGame('Li√™n Qu√¢n')">‚öîÔ∏è<h3>Li√™n Qu√¢n</h3></div>
        <div class="game-card" onclick="openGame('Li√™n Qu√¢n 0k')">üéÅ<h3>Li√™n Qu√¢n 0k</h3></div>
        <div class="game-card" style="background:#fff9e6;border:2px solid #f1c40f" onclick="openGame('M√£ T·∫∑ng')">üé´<h3>M√£ T·∫∑ng</h3></div>
    </div>
    <div id="detail-game" style="display:none; padding:10px; max-width:600px; margin:auto;">
        <button style="background:#95a5a6; width:auto; margin-bottom:15px;" onclick="backToMenu()">‚¨Ö Quay l·∫°i</button>
        <div id="acc-list-grid" class="acc-grid"></div>
    </div>
</div>

<div id="tab-topup" class="tab-sec" style="display:none">
    <div class="card">
        <h3>üí≥ N·∫°p Th·∫ª C√†o</h3>
        <select id="card-type">
            <option value="Viettel">Viettel</option>
            <option value="Vinaphone">Vinaphone</option>
            <option value="Mobifone">Mobifone</option>
            <option value="Zing">Th·∫ª Zing (Zina)</option>
            <option value="Garena">Th·∫ª Garena</option>
        </select>
        <select id="card-amount">
            <option value="10000">10.000ƒë</option>
            <option value="20000">20.000ƒë</option>
            <option value="50000">50.000ƒë</option>
            <option value="100000">100.000ƒë</option>
            <option value="200000">200.000ƒë</option>
            <option value="500000">500.000ƒë</option>
        </select>
        <input type="text" id="card-seri" placeholder="S·ªë Seri th·∫ª">
        <input type="text" id="card-pin" placeholder="M√£ n·∫°p (Pin)">
        <button class="btn-red" onclick="sendCard()">G·ª¨I TH·∫∫</button>
        <p style="font-size:10px; color:var(--red); margin-top:10px;">* Ch√∫ √Ω: Nh·∫≠p sai Seri/M√£ s·∫Ω kh√¥ng ƒë∆∞·ª£c c·ªông ti·ªÅn.</p>
    </div>
    
    <div class="card">
        <h3>üéÅ Nh·∫≠p Giftcode</h3>
        <input type="text" id="gift-input" placeholder="D√°n m√£ qu√† t·∫∑ng v√†o ƒë√¢y">
        <button class="btn-blue" onclick="useGiftcode()">NH·∫¨N QU√Ä</button>
    </div>
</div>

<div id="tab-his" class="tab-sec" style="display:none; padding:15px;">
    <div id="his-display"></div>
</div>

<div id="tab-adm" class="tab-sec" style="display:none">
    <div class="card">
        <h3>‚è≥ Th·∫ª Ch·ªù Duy·ªát</h3>
        <table class="user-table">
            <thead><tr><th>Kh√°ch/M·∫°ng</th><th>M·ªánh gi√°</th><th>Seri/M√£</th><th>L·ªánh</th></tr></thead>
            <tbody id="card-list-adm"></tbody>
        </table>
    </div>
    
    <div class="card">
        <h3>üë• Qu·∫£n L√Ω Kh√°ch</h3>
        <table class="user-table">
            <thead><tr><th>T√™n</th><th>Ti·ªÅn</th><th>L·ªánh</th></tr></thead>
            <tbody id="user-list-adm"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>üì§ ƒêƒÉng Acc / T·∫°o Giftcode</h3>
        <select id="post-cat">
            <option>Roblox</option><option>Free Fire</option><option>Li√™n Qu√¢n</option>
            <option>Li√™n Qu√¢n 0k</option><option>M√£ T·∫∑ng</option><option value="Giftcode">üéÅ T·∫°o Giftcode</option>
        </select>
        <input id="post-u" placeholder="T√†i kho·∫£n ho·∫∑c M√£ Giftcode">
        <input id="post-p" placeholder="M·∫≠t kh·∫©u (Giftcode th√¨ b·ªè tr·ªëng)">
        <input id="post-pr" type="number" placeholder="Gi√° ho·∫∑c Ti·ªÅn t·∫∑ng (Giftcode)">
        <button class="btn-orange" onclick="admPost()">ƒêƒÇNG L√äN SHOP</button>
    </div>
</div>

<div id="auth-modal" class="modal">
    <div class="modal-content">
        <h2 id="modal-title">ƒêƒÇNG NH·∫¨P</h2>
        <input type="text" id="u-in" placeholder="T√†i kho·∫£n">
        <input type="password" id="p-in" placeholder="M·∫≠t kh·∫©u">
        <button class="btn-red" onclick="doAuth()">X√ÅC NH·∫¨N</button>
        <p id="toggle-text" style="cursor:pointer;font-size:12px;margin-top:15px;color:#777" onclick="toggleAuthMode()">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω</p>
    </div>
</div>

<script>
    // --- C·∫§U H√åNH FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyDTgTlg0VFzShYf-g83t6ep5y6WuRM6AVo",
        authDomain: "shophaianh-48d0f.firebaseapp.com",
        projectId: "shophaianh-48d0f",
        storageBucket: "shophaianh-48d0f.firebasestorage.app",
        messagingSenderId: "51501868207",
        appId: "1:51501868207:web:cd24d5dc02b0edff39605a",
        databaseURL: "https://shophaianh-48d0f-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const ADMIN_USER = "adminHaianh";
    let isLoginMode = true;
    let db = { users: [], accs: [], cards: [], codes: [], session: localStorage.getItem('haianh_ss') };

    // --- ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU ---
    database.ref('/').on('value', (s) => {
        const data = s.val() || {};
        db.users = data.users || [{u: ADMIN_USER, p: "Haiadmin", m: 999999999}];
        db.accs = data.accs || [];
        db.cards = data.cards || [];
        db.codes = data.codes || [];
        render();
    });

    function save() { database.ref('/').set({ users: db.users, accs: db.accs, cards: db.cards, codes: db.codes }); }

    // --- HI·ªÇN TH·ªä CH√çNH ---
    function render() {
        if(!db.session) { document.getElementById('auth-modal').style.display = 'flex'; return; }
        document.getElementById('auth-modal').style.display = 'none';
        
        let me = db.users.find(u => u.u === db.session);
        if(!me) { logout(); return; }

        let moneyDisplay = me.u === ADMIN_USER ? "‚àû" : me.m.toLocaleString() + "ƒë";
        document.getElementById('auth-zone').innerHTML = `<span>üí∞ ${moneyDisplay}</span> | <b onclick="logout()" style="color:var(--red);cursor:pointer">THO√ÅT</b>`;
        document.getElementById('tab-his-btn').style.display = 'block';

        if(me.u === ADMIN_USER) {
            document.getElementById('tab-adm-btn').style.display = 'block';
            
            // Render th·∫ª ch·ªù
            document.getElementById('card-list-adm').innerHTML = db.cards.map(c => `
                <tr>
                    <td><b>${c.user}</b><br><span class="badge">${c.type}</span></td>
                    <td>${c.amount.toLocaleString()}ƒë</td>
                    <td>S:${c.seri}<br>M:${c.pin}</td>
                    <td>
                        <button class="btn-buy btn-mini" onclick="approveCard('${c.id}')">V</button>
                        <button class="btn-red btn-mini" onclick="delCard('${c.id}')">X</button>
                    </td>
                </tr>`).join('');

            // Render kh√°ch
            document.getElementById('user-list-adm').innerHTML = db.users.map(u => `
                <tr>
                    <td>${u.u}</td>
                    <td>${u.u === ADMIN_USER ? '‚àû' : u.m.toLocaleString() + 'ƒë'}</td>
                    <td>
                        <button class="btn-buy btn-mini" onclick="changeMoney('${u.u}', 1)">+</button>
                        <button class="btn-blue btn-mini" onclick="changeMoney('${u.u}', -1)">-</button>
                        ${u.u !== ADMIN_USER ? `<button class="btn-red btn-mini" onclick="delUser('${u.u}')">X</button>` : ''}
                    </td>
                </tr>`).join('');
        }

        document.getElementById('his-display').innerHTML = `<h3>üìú L·ªãch s·ª≠ mua h√†ng</h3>` + 
            (me.bought || []).map(a => `<div class="card"><b>[${a.cat}]</b> T√†i kho·∫£n: <code style="color:blue">${a.u}</code> | M·∫≠t kh·∫©u: <code style="color:red">${a.p}</code></div>`).join('') || "B·∫°n ch∆∞a mua t√†i kho·∫£n n√†o.";
    }

    // --- CH·ª®C NƒÇNG NG∆Ø·ªúI D√ôNG ---
    function doAuth() {
        let u = document.getElementById('u-in').value.trim(), p = document.getElementById('p-in').value.trim();
        if(u.length < 3 || p.length < 3) return alert("T√™n v√† m·∫≠t kh·∫©u ph·∫£i tr√™n 3 k√Ω t·ª±!");
        
        if(isLoginMode) {
            let user = db.users.find(x => x.u === u && x.p === p);
            if(user) { db.session = u; localStorage.setItem('haianh_ss', u); render(); } 
            else alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
        } else {
            if(db.users.find(x => x.u === u)) return alert("T√†i kho·∫£n n√†y ƒë√£ t·ªìn t·∫°i!");
            db.users.push({u, p, m: 0, bought: []}); save();
            alert("ƒêƒÉng k√Ω th√†nh c√¥ng! H√£y ƒëƒÉng nh·∫≠p."); toggleAuthMode();
        }
    }

    function sendCard() {
        let type = document.getElementById('card-type').value;
        let amount = parseInt(document.getElementById('card-amount').value);
        let seri = document.getElementById('card-seri').value.trim();
        let pin = document.getElementById('card-pin').value.trim();

        if(seri.length < 5 || pin.length < 5) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Seri v√† M√£ th·∫ª!");
        
        db.cards.push({id: Date.now(), user: db.session, type, amount, seri, pin});
        save();
        alert("G·ª≠i th·∫ª th√†nh c√¥ng! Vui l√≤ng ch·ªù admin duy·ªát.");
        document.getElementById('card-seri').value = ""; document.getElementById('card-pin').value = "";
    }

    function useGiftcode() {
        let codeIn = document.getElementById('gift-input').value.trim();
        let idx = db.codes.findIndex(c => c.u === codeIn);
        if(idx === -1) return alert("M√£ Giftcode kh√¥ng ƒë√∫ng ho·∫∑c ƒë√£ b·ªã s·ª≠ d·ª•ng!");
        
        let me = db.users.find(u => u.u === db.session);
        me.m += db.codes[idx].pr;
        db.codes.splice(idx, 1); // X√≥a m√£ sau khi d√πng
        save();
        alert("B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c " + db.codes[idx-idx].pr.toLocaleString() + "ƒë v√†o t√†i kho·∫£n!");
        document.getElementById('gift-input').value = "";
    }

    function openGame(cat) {
        document.getElementById('menu-game').style.display = 'none';
        document.getElementById('detail-game').style.display = 'block';
        let filtered = db.accs.filter(a => a.cat === cat && !a.sold);
        document.getElementById('acc-list-grid').innerHTML = filtered.map(a => `
            <div class="acc-box">
                <b style="font-size:11px">M√£: #${a.id.toString().slice(-4)}</b><br>
                <span style="color:var(--red); font-weight:bold">${a.pr.toLocaleString()}ƒë</span><br>
                <button class="btn-buy" style="margin-top:5px; padding:6px; font-size:12px" onclick="buy(${a.id})">MUA NGAY</button>
            </div>`).join('') || "<p style='grid-column: 1/3'>H·∫øt h√†ng, quay l·∫°i sau nh√©!</p>";
    }

    function buy(id) {
        let me = db.users.find(u => u.u === db.session), acc = db.accs.find(a => a.id === id);
        if(me.u !== ADMIN_USER && me.m < acc.pr) return alert("B·∫°n kh√¥ng ƒë·ªß ti·ªÅn, h√£y n·∫°p th√™m nh√©!");
        if(confirm("X√°c nh·∫≠n mua t√†i kho·∫£n n√†y v·ªõi gi√° " + acc.pr.toLocaleString() + "ƒë?")) {
            if(me.u !== ADMIN_USER) me.m -= acc.pr;
            acc.sold = true;
            if(!me.bought) me.bought = [];
            me.bought.push(acc);
            save(); alert("Mua th√†nh c√¥ng! Th√¥ng tin ƒë√£ l∆∞u trong L·ªãch s·ª≠.");
            openGame(acc.cat);
        }
    }

    // --- CH·ª®C NƒÇNG ADMIN ---
    function approveCard(id) {
        let c = db.cards.find(x => x.id == id);
        let u = db.users.find(x => x.u == c.user);
        if(u) u.m += c.amount;
        db.cards = db.cards.filter(x => x.id != id);
        save(); alert("ƒê√£ c·ªông ti·ªÅn cho kh√°ch!");
    }

    function changeMoney(uName, sign) {
        let amount = prompt("Nh·∫≠p s·ªë ti·ªÅn mu·ªën " + (sign > 0 ? "C·ªòNG" : "TR·ª™") + ":");
        if(amount && !isNaN(amount)) {
            let u = db.users.find(x => x.u == uName);
            u.m += (parseInt(amount) * sign);
            if(u.m < 0) u.m = 0;
            save();
        }
    }

    function delUser(uName) {
        if(confirm("X√≥a vƒ©nh vi·ªÖn kh√°ch " + uName + "?")) {
            db.users = db.users.filter(x => x.u !== uName);
            save();
        }
    }

    function delCard(id) {
        if(confirm("X√≥a th·∫ª n√†y? (Th·∫ª sai ho·∫∑c th·∫ª ·∫£o)")) {
            db.cards = db.cards.filter(x => x.id != id);
            save();
        }
    }

    function admPost() {
        let cat = document.getElementById('post-cat').value, u = document.getElementById('post-u').value.trim(), p = document.getElementById('post-p').value.trim(), pr = parseInt(document.getElementById('post-pr').value) || 0;
        if(!u) return alert("Vui l√≤ng nh·∫≠p t√†i kho·∫£n ho·∫∑c m√£!");
        
        if(cat === 'Giftcode') { 
            db.codes.push({u, pr}); 
            alert("ƒê√£ t·∫°o m√£ Giftcode: " + u + " tr·ªã gi√° " + pr + "ƒë");
        } 
        else { 
            db.accs.push({cat, u, p, pr, sold: false, id: Date.now()}); 
            alert("ƒê√£ ƒëƒÉng Acc l√™n m·ª•c " + cat);
        }
        save();
        document.getElementById('post-u').value = ""; document.getElementById('post-p').value = ""; document.getElementById('post-pr').value = "";
    }

    // --- TI·ªÜN √çCH ---
    function toggleAuthMode() { 
        isLoginMode = !isLoginMode; 
        document.getElementById('modal-title').innerText = isLoginMode ? "ƒêƒÇNG NH·∫¨P" : "ƒêƒÇNG K√ù";
        document.getElementById('toggle-text').innerText = isLoginMode ? "Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω" : "ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p";
    }
    function backToMenu() { document.getElementById('menu-game').style.display = 'grid'; document.getElementById('detail-game').style.display = 'none'; }
    function goTab(id, el) { 
        document.querySelectorAll('.tab-sec').forEach(s => s.style.display = 'none'); 
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); 
        document.getElementById('tab-' + id).style.display = 'block'; 
        el.classList.add('active'); 
        if(id === 'buy') backToMenu(); 
    }
    function logout() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
