<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP HAIANH - FULL QUáº¢N TRá»Š</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --green: #2ecc71; --red: #e74c3c; --dark: #2c3e50; --bg: #f1f2f6; --blue: #3498db; --orange: #e67e22; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 30px; }
        .header { background: var(--dark); color: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--green); position: sticky; top: 0; z-index: 1000; }
        .nav { display: flex; background: #fff; border-bottom: 1px solid #ddd; overflow-x: auto; }
        .tab { flex: 1; min-width: 80px; padding: 12px; text-align: center; font-size: 11px; font-weight: bold; color: #777; cursor: pointer; }
        .tab.active { color: var(--green); border-bottom: 3px solid var(--green); }
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; max-width: 600px; margin: auto; }
        .game-card { background: #fff; border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; }
        .acc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .acc-box { background: #fff; border-radius: 10px; padding: 10px; border: 1px solid #ddd; text-align: center; }
        .card { background: white; padding: 15px; border-radius: 10px; margin: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; }
        button { border: none; border-radius: 8px; padding: 12px; font-weight: bold; cursor: pointer; color: white; width: 100%; transition: 0.3s; }
        .btn-buy { background: var(--green); } .btn-red { background: var(--red); } .btn-blue { background: var(--blue); } .btn-orange { background: var(--orange); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center; }
        .user-table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 10px; }
        .user-table th, .user-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .btn-mini { padding: 4px 6px; font-size: 9px; width: auto; margin: 2px; display: inline-block; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold; font-size: 18px;">SHOP HAIANH</div>
    <div id="auth-zone">...</div>
</div>

<div class="nav">
    <div class="tab active" onclick="goTab('buy', this)">MUA ACC</div>
    <div class="tab" onclick="goTab('topup', this)">Náº P TIá»€N</div>
    <div id="tab-his-btn" class="tab" style="display:none" onclick="goTab('his', this)">Lá»ŠCH Sá»¬</div>
    <div id="tab-adm-btn" class="tab" style="display:none" onclick="goTab('adm', this)">QUáº¢N TRá»Š</div>
</div>

<div id="tab-buy" class="tab-sec">
    <div id="menu-game" class="grid-menu">
        <div class="game-card" onclick="openGame('Roblox')">ğŸ¤–<h3>Roblox</h3></div>
        <div class="game-card" onclick="openGame('Free Fire')">ğŸ”¥<h3>Free Fire</h3></div>
        <div class="game-card" onclick="openGame('LiÃªn QuÃ¢n')">âš”ï¸<h3>LiÃªn QuÃ¢n</h3></div>
        <div class="game-card" onclick="openGame('LiÃªn QuÃ¢n 0k')">ğŸ<h3>LiÃªn QuÃ¢n 0k</h3></div>
        <div class="game-card" style="background:#fff9e6;border:2px solid #f1c40f" onclick="openGame('MÃ£ Táº·ng')">ğŸ«<h3>MÃ£ Táº·ng</h3></div>
    </div>
    <div id="detail-game" style="display:none; padding:10px; max-width:600px; margin:auto;">
        <button style="background:#95a5a6; width:auto; margin-bottom:15px;" onclick="backToMenu()">â¬… Quay láº¡i</button>
        <div id="acc-list-grid" class="acc-grid"></div>
    </div>
</div>

<div id="tab-topup" class="tab-sec" style="display:none">
    <div class="card">
        <h3>ğŸ’³ Náº¡p Tháº» CÃ o (Duyá»‡t tay)</h3>
        <select id="card-type">
            <option>Viettel</option><option>Vinaphone</option><option>Mobifone</option><option>Zing</option><option>Garena</option>
        </select>
        <select id="card-amount">
            <option value="10000">10.000Ä‘</option><option value="20000">20.000Ä‘</option><option value="50000">50.000Ä‘</option>
            <option value="100000">100.000Ä‘</option><option value="200000">200.000Ä‘</option><option value="500000">500.000Ä‘</option>
        </select>
        <input type="text" id="card-seri" placeholder="Nháº­p sá»‘ Seri">
        <input type="text" id="card-pin" placeholder="Nháº­p mÃ£ tháº»">
        <button class="btn-red" onclick="sendCard()">Gá»¬I THáºº DUYá»†T</button>
    </div>
    <div class="card">
        <h3>ğŸ Nháº­p Giftcode</h3>
        <input type="text" id="gift-input" placeholder="Nháº­p mÃ£ quÃ  táº·ng">
        <button class="btn-blue" onclick="useGiftcode()">NHáº¬N QUÃ€</button>
    </div>
</div>

<div id="tab-his" class="tab-sec" style="display:none; padding:15px;"><div id="his-display"></div></div>

<div id="tab-adm" class="tab-sec" style="display:none">
    <div class="card" style="background: #fff0f0;">
        <h3>ğŸ’ Táº O MÃƒ GIFTCODE</h3>
        <input id="adm-gift-code" placeholder="MÃ£ muá»‘n táº¡o (VÃ­ dá»¥: TANTHU88)">
        <input id="adm-gift-val" type="number" placeholder="Sá»‘ tiá»n nháº­n Ä‘Æ°á»£c">
        <button class="btn-blue" onclick="createGiftcode()">Táº O & ÄÄ‚NG MÃƒ</button>
    </div>

    <div class="card">
        <h3>â³ Tháº» Chá» Duyá»‡t</h3>
        <table class="user-table">
            <thead><tr><th>KhÃ¡ch</th><th>Má»‡nh giÃ¡</th><th>Seri/MÃ£</th><th>Lá»‡nh</th></tr></thead>
            <tbody id="card-list-adm"></tbody>
        </table>
    </div>
    
    <div class="card">
        <h3>ğŸ‘¥ KhÃ¡ch HÃ ng</h3>
        <table class="user-table">
            <thead><tr><th>TÃªn</th><th>Tiá»n</th><th>Lá»‡nh</th></tr></thead>
            <tbody id="user-list-adm"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>ğŸ“¤ ÄÄƒng Acc Game</h3>
        <select id="post-cat">
            <option>Roblox</option><option>Free Fire</option><option>LiÃªn QuÃ¢n</option><option>LiÃªn QuÃ¢n 0k</option><option>MÃ£ Táº·ng</option>
        </select>
        <input id="post-u" placeholder="TÃ i khoáº£n">
        <input id="post-p" placeholder="Máº­t kháº©u">
        <input id="post-pr" type="number" placeholder="GiÃ¡ bÃ¡n">
        <button class="btn-orange" onclick="admPost()">ÄÄ‚NG ACC</button>
    </div>
</div>

<div id="auth-modal" class="modal">
    <div class="modal-content">
        <h2 id="modal-title">ÄÄ‚NG NHáº¬P</h2>
        <input type="text" id="u-in" placeholder="TÃ i khoáº£n"><input type="password" id="p-in" placeholder="Máº­t kháº©u">
        <button class="btn-red" onclick="doAuth()">VÃ€O SHOP</button>
        <p id="toggle-text" style="cursor:pointer;font-size:12px;margin-top:15px;color:#777" onclick="toggleAuthMode()">ChÆ°a cÃ³ tÃ i khoáº£n? ÄÄƒng kÃ½</p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDTgTlg0VFzShYf-g83t6ep5y6WuRM6AVo",
        authDomain: "shophaianh-48d0f.firebaseapp.com",
        projectId: "shophaianh-48d0f",
        storageBucket: "shophaianh-48d0f.firebasestorage.app",
        messagingSenderId: "51501868207",
        appId: "1:51501868207:web:cd24d5dc02b0edff39605a",
        databaseURL: "https://shophaianh-48d0f-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const ADMIN_USER = "adminHaianh";
    let isLoginMode = true;
    let db = { users: [], accs: [], cards: [], codes: [], session: localStorage.getItem('haianh_ss') };

    database.ref('/').on('value', (s) => {
        const data = s.val() || {};
        db.users = data.users || [{u: ADMIN_USER, p: "Haiadmin", m: 999999999}];
        db.accs = data.accs || [];
        db.cards = data.cards || [];
        db.codes = data.codes || [];
        render();
    });

    function save() { database.ref('/').set(db); }

    function render() {
        if(!db.session) { document.getElementById('auth-modal').style.display = 'flex'; return; }
        document.getElementById('auth-modal').style.display = 'none';
        let me = db.users.find(u => u.u === db.session);
        if(!me) { logout(); return; }

        document.getElementById('auth-zone').innerHTML = `<span>ğŸ’° ${me.u === ADMIN_USER ? 'âˆ' : me.m.toLocaleString() + 'Ä‘'}</span> | <b onclick="logout()" style="color:var(--red);cursor:pointer">THOÃT</b>`;
        document.getElementById('tab-his-btn').style.display = 'block';

        if(me.u === ADMIN_USER) {
            document.getElementById('tab-adm-btn').style.display = 'block';
            document.getElementById('card-list-adm').innerHTML = db.cards.map(c => `<tr><td>${c.user}<br><b>${c.type}</b></td><td>${c.amount.toLocaleString()}</td><td>S:${c.seri}<br>M:${c.pin}</td><td><button class="btn-buy btn-mini" onclick="approveCard('${c.id}')">V</button><button class="btn-red btn-mini" onclick="delCard('${c.id}')">X</button></td></tr>`).join('');
            document.getElementById('user-list-adm').innerHTML = db.users.map(u => `<tr><td>${u.u}</td><td>${u.u === ADMIN_USER ? 'âˆ' : u.m.toLocaleString() + 'Ä‘'}</td><td><button class="btn-buy btn-mini" onclick="changeMoney('${u.u}', 1)">+</button><button class="btn-blue btn-mini" onclick="changeMoney('${u.u}', -1)">-</button>${u.u !== ADMIN_USER ? `<button class="btn-red btn-mini" onclick="delUser('${u.u}')">X</button>` : ''}</td></tr>`).join('');
        }
        document.getElementById('his-display').innerHTML = `<h3>ğŸ“œ Lá»‹ch sá»­</h3>` + (me.bought || []).map(a => `<div class="card"><b>[${a.cat}]</b> TK: ${a.u} | MK: ${a.p}</div>`).join('') || "Trá»‘ng!";
    }

    // --- LOGIC ---
    function doAuth() {
        let u = document.getElementById('u-in').value.trim(), p = document.getElementById('p-in').value.trim();
        if(isLoginMode) {
            let user = db.users.find(x => x.u === u && x.p === p);
            if(user) { db.session = u; localStorage.setItem('haianh_ss', u); render(); } else alert("Sai!");
        } else {
            if(db.users.find(x => x.u === u)) return alert("TÃªn Ä‘Ã£ tá»“n táº¡i!");
            db.users.push({u, p, m: 0, bought: []}); save(); alert("ÄÄƒng kÃ½ xong!"); toggleAuthMode();
        }
    }

    function sendCard() {
        let pin = document.getElementById('card-pin').value.trim(), seri = document.getElementById('card-seri').value.trim();
        if(pin.length < 5 || seri.length < 5) return alert("Nháº­p Ä‘á»§ Seri vÃ  MÃ£ tháº»!");
        db.cards.push({id: Date.now(), user: db.session, type: document.getElementById('card-type').value, amount: parseInt(document.getElementById('card-amount').value), seri, pin});
        save(); alert("ÄÃ£ gá»­i tháº» chá» duyá»‡t!");
    }

    function createGiftcode() {
        let code = document.getElementById('adm-gift-code').value.trim();
        let val = parseInt(document.getElementById('adm-gift-val').value);
        if(!code || !val) return alert("Nháº­p mÃ£ vÃ  sá»‘ tiá»n!");
        db.codes.push({code, val});
        save();
        alert("ÄÃ£ táº¡o mÃ£: " + code + " trá»‹ giÃ¡ " + val + "Ä‘");
        document.getElementById('adm-gift-code').value = ""; document.getElementById('adm-gift-val').value = "";
    }

    function useGiftcode() {
        let codeIn = document.getElementById('gift-input').value.trim();
        let idx = db.codes.findIndex(c => c.code === codeIn);
        if(idx === -1) return alert("MÃ£ sai hoáº·c Ä‘Ã£ dÃ¹ng!");
        let me = db.users.find(u => u.u === db.session);
        me.m += db.codes[idx].val; db.codes.splice(idx, 1);
        save(); alert("ThÃ nh cÃ´ng!");
    }

    function openGame(cat) {
        document.getElementById('menu-game').style.display = 'none';
        document.getElementById('detail-game').style.display = 'block';
        let filtered = db.accs.filter(a => a.cat === cat && !a.sold);
        document.getElementById('acc-list-grid').innerHTML = filtered.map(a => `<div class="acc-box"><b>#${a.id.toString().slice(-4)}</b><br><span style="color:red">${a.pr.toLocaleString()}Ä‘</span><br><button class="btn-buy" onclick="buy(${a.id})">MUA</button></div>`).join('') || "Háº¿t hÃ ng!";
    }

    function buy(id) {
        let me = db.users.find(u => u.u === db.session), acc = db.accs.find(a => a.id === id);
        if(me.u !== ADMIN_USER && me.m < acc.pr) return alert("Thiáº¿u tiá»n!");
        if(confirm("XÃ¡c nháº­n mua?")) {
            if(me.u !== ADMIN_USER) me.m -= acc.pr;
            acc.sold = true; if(!me.bought) me.bought = []; me.bought.push(acc);
            save(); alert("ThÃ nh cÃ´ng!"); openGame(acc.cat);
        }
    }

    function admPost() {
        db.accs.push({cat: document.getElementById('post-cat').value, u: document.getElementById('post-u').value, p: document.getElementById('post-p').value, pr: parseInt(document.getElementById('post-pr').value), sold: false, id: Date.now()});
        save(); alert("ÄÃ£ Ä‘Äƒng!");
    }

    function approveCard(id) {
        let c = db.cards.find(x => x.id == id), u = db.users.find(x => x.u == c.user);
        if(u) u.m += c.amount; db.cards = db.cards.filter(x => x.id != id); save();
    }

    function changeMoney(uName, s) { let a = prompt("Tiá»n:"); if(a) { db.users.find(x => x.u == uName).m += (parseInt(a) * s); save(); } }
    function delUser(u) { if(confirm("XÃ³a?")) { db.users = db.users.filter(x => x.u !== u); save(); } }
    function delCard(id) { db.cards = db.cards.filter(x => x.id != id); save(); }
    function toggleAuthMode() { isLoginMode = !isLoginMode; document.getElementById('modal-title').innerText = isLoginMode ? "ÄÄ‚NG NHáº¬P" : "ÄÄ‚NG KÃ"; }
    function backToMenu() { document.getElementById('menu-game').style.display = 'grid'; document.getElementById('detail-game').style.display = 'none'; }
    function goTab(id, el) { document.querySelectorAll('.tab-sec').forEach(s => s.style.display = 'none'); document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.getElementById('tab-' + id).style.display = 'block'; el.classList.add('active'); }
    function logout() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
