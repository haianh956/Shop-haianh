<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHOP HAIANH - ONLINE 24/7</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --green: #2ecc71; --red: #e74c3c; --dark: #2c3e50; --bg: #f1f2f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 30px; }
        .header { background: var(--dark); color: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--green); position: sticky; top: 0; z-index: 1000; }
        .nav { display: flex; background: #fff; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; padding: 12px; text-align: center; font-size: 12px; font-weight: bold; color: #777; cursor: pointer; }
        .tab.active { color: var(--green); border-bottom: 3px solid var(--green); }
        .card { background: white; padding: 15px; border-radius: 10px; margin: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { border: none; border-radius: 8px; padding: 12px; font-weight: bold; cursor: pointer; color: white; width: 100%; }
        .btn-buy { background: var(--green); }
        .btn-red { background: var(--red); }
        .user-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .user-table th, .user-table td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold;">SHOP HAIANH</div>
    <div id="auth-zone">ƒêang t·∫£i...</div>
</div>

<div class="nav">
    <div class="tab active" onclick="goTab('buy', this)">MUA ACC</div>
    <div class="tab" onclick="goTab('topup', this)">N·∫†P TI·ªÄS</div>
    <div id="tab-adm-btn" class="tab" style="display:none" onclick="goTab('adm', this)">QU·∫¢N TR·ªä</div>
</div>

<div id="tab-buy" class="tab-sec">
    <div class="card"><h3>Ch√†o m·ª´ng c·∫≠u ƒë·∫øn v·ªõi Shop HaiAnh!</h3><p>Ch·ªçn danh m·ª•c ph√≠a d∆∞·ªõi ƒë·ªÉ mua acc nh√©.</p></div>
</div>

<div id="tab-topup" class="tab-sec" style="display:none; padding:15px;">
    <div class="card">
        <h3>üí≥ N·∫°p Th·∫ª C√†o</h3>
        <input type="text" id="card-seri" placeholder="S·ªë Seri">
        <input type="text" id="card-pin" placeholder="M√£ th·∫ª">
        <button class="btn-red" onclick="sendCard()">G·ª¨I TH·∫∫ DUY·ªÜT</button>
    </div>
</div>

<div id="tab-adm" class="tab-sec" style="display:none; padding:15px;">
    <div class="card">
        <h3>üë• Qu·∫£n L√Ω Kh√°ch</h3>
        <table class="user-table"><tbody id="user-list-adm"></tbody></table>
    </div>
</div>

<script>
    // 1. C·∫§U H√åNH FIREBASE C·ª¶A C·∫¨U
    const firebaseConfig = {
        apiKey: "AIzaSyDTgTlg0VFzShYf-g83t6ep5y6WuRM6AVo",
        authDomain: "shophaianh-48d0f.firebaseapp.com",
        projectId: "shophaianh-48d0f",
        storageBucket: "shophaianh-48d0f.firebasestorage.app",
        messagingSenderId: "51501868207",
        appId: "1:51501868207:web:cd24d5dc02b0edff39605a",
        databaseURL: "https://shophaianh-48d0f-default-rtdb.firebaseio.com" // T·ªõ ƒë√£ th√™m d√≤ng n√†y cho c·∫≠u
    };

    // 2. KH·ªûI T·∫†O
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const ADMIN_USER = "adminHaianh";

    let db = { users: [], accs: [], cards: [], session: localStorage.getItem('haianh_session') };

    // 3. ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU
    database.ref('/').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            db.users = data.users || [];
            db.accs = data.accs || [];
            db.cards = data.cards || [];
            render();
        } else {
            // Kh·ªüi t·∫°o admin n·∫øu database tr·ªëng
            db.users = [{u: ADMIN_USER, p: "Haiadmin", m: 999999}];
            save();
        }
    });

    function save() {
        database.ref('/').set({ users: db.users, accs: db.accs, cards: db.cards });
    }

    function render() {
        if (!db.session) {
            document.getElementById('auth-zone').innerHTML = `<button onclick="login()" style="width:auto;padding:5px 10px;background:var(--green)">ƒêƒÇNG NH·∫¨P</button>`;
        } else {
            let me = db.users.find(u => u.u === db.session);
            if (me) {
                document.getElementById('auth-zone').innerHTML = `<span>üí∞ ${me.m.toLocaleString()}ƒë</span> | <b onclick="logout()" style="color:var(--red);cursor:pointer">THO√ÅT</b>`;
                if (me.u === ADMIN_USER) {
                    document.getElementById('tab-adm-btn').style.display = 'block';
                    document.getElementById('user-list-adm').innerHTML = db.users.map(u => `
                        <tr><td>${u.u}</td><td>${u.m}ƒë</td><td><button onclick="deleteUser('${u.u}')" style="background:red;padding:2px">X</button></td></tr>
                    `).join('');
                }
            }
        }
    }

    function login() {
        let u = prompt("T√†i kho·∫£n:"), p = prompt("M·∫≠t kh·∫©u:");
        let user = db.users.find(x => x.u === u && x.p === p);
        if (user) {
            db.session = u;
            localStorage.setItem('haianh_session', u);
            render();
        } else {
            if (confirm("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n. ƒêƒÉng k√Ω m·ªõi?")) {
                db.users.push({u, p, m: 0});
                save();
                alert("ƒê√£ ƒëƒÉng k√Ω! H√£y ƒëƒÉng nh·∫≠p l·∫°i.");
            }
        }
    }

    function logout() {
        localStorage.removeItem('haianh_session');
        location.reload();
    }

    function goTab(id, el) {
        document.querySelectorAll('.tab-sec').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + id).style.display = 'block';
        el.classList.add('active');
    }

    function deleteUser(name) {
        if(name === ADMIN_USER) return;
        db.users = db.users.filter(u => u.u !== name);
        save();
    }
</script>
</body>
</html>
